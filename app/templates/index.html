{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Study Plan Area -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>Study Plan</h3>
                <div class="d-flex justify-content-between align-items-center">
                    <select id="major-select" class="form-select w-auto">
                        <option value="">Select a Major...</option>
                    </select>
                    <div>
                        <button id="generate-plan" class="btn btn-primary" disabled>Generate Plan</button>
                        <button id="ai-validate-plan" class="btn btn-warning" disabled title="Comprehensive AI quality analysis">
                            <i class="fas fa-robot"></i> AI Validate Plan
                        <span id="ai-status-indicator"
                              class="badge rounded-pill ms-2"
                              style="display:none;"></span>
                        <span id="ai-status-indicator"
                              class="badge rounded-pill ms-2"
                              style="display:none;"></span>
                        </button>
                        <button id="export-pdf" class="btn btn-success" disabled>Export PDF</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="study-plan-container">
                    <div class="text-center text-muted py-5">
                        <h5>Select a major and click "Generate Plan" to get started</h5>
                    </div>
                </div>

                <!-- Study Plan Grid (hidden initially) -->
                <div id="plan-grid" class="row" style="display: none;">
                    <!-- Year 1 -->
                    <div class="col-md-12 mb-3">
                        <h5>Year 1</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="semester-container">
                                    <h6>Semester 1</h6>
                                    <div class="semester-units" id="Year 1, Semester 1" data-semester="Year 1, Semester 1">
                                        <div class="drop-zone">Drop units here (4 max)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="semester-container">
                                    <h6>Semester 2</h6>
                                    <div class="semester-units" id="Year 1, Semester 2" data-semester="Year 1, Semester 2">
                                        <div class="drop-zone">Drop units here (4 max)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Year 2 -->
                    <div class="col-md-12 mb-3">
                        <h5>Year 2</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="semester-container">
                                    <h6>Semester 1</h6>
                                    <div class="semester-units" id="Year 2, Semester 1" data-semester="Year 2, Semester 1">
                                        <div class="drop-zone">Drop units here (4 max)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="semester-container">
                                    <h6>Semester 2</h6>
                                    <div class="semester-units" id="Year 2, Semester 2" data-semester="Year 2, Semester 2">
                                        <div class="drop-zone">Drop units here (4 max)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Year 3 -->
                    <div class="col-md-12">
                        <h5>Year 3</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="semester-container">
                                    <h6>Semester 1</h6>
                                    <div class="semester-units" id="Year 3, Semester 1" data-semester="Year 3, Semester 1">
                                        <div class="drop-zone">Drop units here (4 max)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="semester-container">
                                    <h6>Semester 2</h6>
                                    <div class="semester-units" id="Year 3, Semester 2" data-semester="Year 3, Semester 2">
                                        <div class="drop-zone">Drop units here (4 max)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel -->
    <div class="col-md-4">
        <!-- Validation Status -->
        <div class="card mb-3">
            <div class="card-header">
                <h5>Plan Validation</h5>
            </div>
            <div class="card-body">
                <div id="validation-status">
                    <div class="text-muted">Generate a plan to see validation status</div>
                </div>
            </div>
        </div>

        <!-- Available Units -->
        <div class="card mb-3">
            <div class="card-header">
                <h5>Available Units</h5>

                <!-- Trash/Remove Zone -->
                <div id="trash-zone" class="trash-zone mt-2 mb-2">
                    <div class="trash-content">
                        <i class="fas fa-trash"></i>
                        <span>Drop here to remove</span>
                    </div>
                </div>

                <input type="text" id="unit-search" class="form-control form-control-sm mt-2" placeholder="Search units...">
            </div>
            <div class="card-body">
                <div id="available-units" class="units-list">
                    <div class="text-muted">Generate a plan to see available units</div>
                </div>
            </div>
        </div>

        <!-- AI Debugging -->
        <div class="card">
            <div class="card-header">
                <h5>AI Debug Log</h5>
            </div>
            <div class="card-body">
                <div id="debug-log" class="debug-output">
                    <div class="text-muted">AI interactions will appear here</div>
                </div>
            </div>
            <div class="card-footer">
                <form id="ai-chat-form" class="d-flex">
                    <input id="ai-chat-input" type="text" class="form-control me-2"
                           placeholder="Ask AI (e.g. focus on microeconomics)">
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loading-modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <div class="mt-3">
                    <h5 id="loading-message">Generating study plan...</h5>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
